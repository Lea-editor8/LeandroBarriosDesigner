---
import { Image } from "astro:assets";

interface Props {
    imgPortada: string;
    imgFull: string;
    titulo: string;
    descripcion: string;
    linkExterno?: string;
    large?: boolean; // Por si queremos hacer cards más grandes en el futuro
    delay?: number;
}

const {
    imgPortada,
    imgFull,
    titulo,
    descripcion,
    linkExterno,
    large = false,
    delay = 0,
} = Astro.props;

// Dynamically import images
const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/imagenes/*.{jpeg,jpg,png,gif}",
    { eager: true },
);

const portadaSrc = `/src/assets${imgPortada}`;
const fullSrc = `/src/assets${imgFull}`;

const imagePortada = images[portadaSrc]?.default;
const imageFull = images[fullSrc]?.default;

if (!imagePortada) {
    console.error(`Imagen de portada no encontrada: ${portadaSrc}`);
}
if (!imageFull) {
    console.error(`Imagen completa no encontrada: ${fullSrc}`);
}
---

{
    linkExterno ? (
        <a
            href={linkExterno}
            target="_blank"
            class={`relative group overflow-hidden cursor-pointer project-item animate ${large ? "col-span-2 row-span-2" : ""}`}
            style={`transition-delay: ${delay}ms`}
            data-full-image={imageFull?.src}
            data-project-title={titulo}
            data-project-description={descripcion}
        >
            {imagePortada && (
                <Image
                    src={imagePortada}
                    alt={titulo}
                    width={large ? 800 : 400}
                    height={large ? 800 : 400}
                    class="w-full h-full object-cover transform transition-transform duration-500 group-hover:scale-110 group-focus:scale-110"
                />
            )}
            <div class="absolute inset-0 bg-black/60 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-300 p-6 text-center backdrop-blur-sm">
                <h3 class="text-xl font-bold text-white mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                    {titulo}
                </h3>
                <span class="inline-block px-4 py-2 border border-white/30 text-white text-sm rounded-full hover:bg-white/20 transition-colors">
                    Visitar sitio
                </span>
            </div>
        </a>
    ) : (
        <div
            class={`relative group overflow-hidden cursor-pointer project-item animate ${large ? "col-span-2 row-span-2" : ""}`}
            data-full-image={imageFull?.src}
            data-project-title={titulo}
            data-project-description={descripcion}
        >
            {imagePortada && (
                <Image
                    src={imagePortada}
                    alt={titulo}
                    width={large ? 800 : 400}
                    height={large ? 800 : 400}
                    class="w-full h-full object-cover transform transition-transform duration-500 group-hover:scale-110 group-focus:scale-110"
                />
            )}

            <div class="absolute inset-0 bg-black/60 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-300 p-6 text-center backdrop-blur-sm">
                <h3 class="text-xl font-bold text-white mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                    {titulo}
                </h3>
                <span class="text-white/80 text-sm translate-y-4 group-hover:translate-y-0 transition-transform duration-300 delay-75">
                    Ver detalles
                </span>
            </div>
        </div>
    )
}

<style>
    /* Podríamos mover estilos específicos aquí si quisiéramos encapsular más */
</style>
